# AWS Route53 Application Recovery Controller Module

AWS Route53 Application Recovery Controller (ARC) is a set of capabilities that continuously monitors an applicationâ€™s ability to recover from failures and controls application recovery across multiple AWS Availability Zones, AWS Regions, and on premises environments to help you to build applications that must deliver very high availability.

This module can deploy just the Readiness Resources or both the Readiness and Recovery Cluster Resources. Much of this code was adapted from [this AWS Blog](https://aws.amazon.com/blogs/networking-and-content-delivery/running-recovery-oriented-applications-with-amazon-route-53-application-recovery-controller-aws-ci-cd-tools-and-terraform/) which can also provide more context on ARC design and terms.

## Usage

The primary configuration item is `cells_definition` which is a nested map that tells ARC which resources per region need to be added to ARC. Example usage below.

### Readiness Resources Only

The below `terraform.tfvars` variable values would create a Recovery Group with Cells for `us-east-1` and `us-west-2`, a Resource Set for services `elasticloadbalancing`, `autoscaling`, `dynamodb`, and `ec2-volume` for each region and arn is provided, and Readiness Checks for each service.

```terraform
name = "my-asg-elb-ddb-app"

cells_definition = {
  us-east-1 = {
    elasticloadbalancing = <arn>
    autoscaling          = <arn>
    dynamodb             = <arn>
    ec2-volume           = <arn>
  }
  us-west-2 = {
    elasticloadbalancing = <arn>
    autoscaling          = <arn>
    dynamodb             = <arn>
    ec2-volume           = <arn>
  }
}
```

### Routing Control Cluster Resources & R53 Alias Records

To define an ARC cluster for managed failover you should add the below values to as terraform variables. Currently we support ACTIVE/PASSIVE for applications across regions. The ACTIVE region is determined by your `provider` block or by `var.primary_cell_region`.

Below would setup a Recovery Cluster with a single Control Panel, 1 Routing Control per region, Safety Rules (default 1, 1+ may be declared), 1 R53 Health Check per Routing Control, and R53 Alias records for each LB for the domain specified.

```terraform
create_recovery_cluster = true

hosted_zone = {
  name         = "mycoolapp.com."
}
```

## Contributing to this Module

### Adding a new service

If any services are added to ARC or missing from this module, to include please make the module aware of the CFN Service Type by completing below steps:

1. add service to `var.resource_type_name` variable type definition
1. add service key (from 1) to validation check for `var.cells_definition` in variables.tf
